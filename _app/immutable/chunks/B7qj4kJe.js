import"./NZTpNUN0.js";import{o as A}from"./0kNXY43k.js";import{C as U,r as V,V as _,P as b,G as k,a as m,U as C,I as v,D as B,am as R,au as L,av as S,g as O,y as D,u as E,k as J,E as M,F as K,H as q}from"./mg2e9jdl.js";import{i as z,b as G,r as H}from"./Ba0xM_Rw.js";import{g as W,f as Q,i as X}from"./DgVSb2ge.js";import{s as P,a as Y}from"./C1kNdz_3.js";function j(o,t){U(t,!0);const[r,i]=Y(),l=()=>P(h,"$rootElement",r),a=()=>P(d,"$viewProps",r),{rootElement:h,treeMap:f,viewProps:d,...g}=V("svelte-tree-view");let s=C(()=>f[t.id]),p=C(()=>m(s).children.length>0),w=C(()=>({node:m(s),getTreeContext:()=>V("svelte-tree-view"),TreeViewNode:j,handleLogNode(){console.log(m(s).getValue());try{window._node=m(s).getValue(),console.info("%c [svelte-tree-view]: Property added to window._node","color: #b8e248")}catch(e){console.error("[svelte-tree-view]: handleLogNode() errored",e)}},handleCopyNodeToClipboard(){try{navigator.clipboard.writeText(JSON.stringify(m(s).getValue()))}catch(e){console.error("[svelte-tree-view]: handleCopyNodeToClipboard() errored",e)}},handleToggleCollapse(){m(p)?g.toggleCollapse(m(s).id):m(s).circularOfId&&(g.expandAllNodesToNode(m(s).circularOfId),l()?.querySelector(`[data-tree-node-id="${m(s).circularOfId}"]`)?.scrollIntoView())}}));var N=_(),u=b(N);k(u,()=>a().treeNode,()=>m(w)),v(o,N),B(),i()}function F(o,t,r,i,l,a){const h=l?[...l.path,o]:[],f=`[${h.join(",")}]`,d=a[f];if(d){const s=d.getValue()===r;return d.key=t,d.getValue=()=>r,d.depth=i,d.type=I(r),d.circularOfId=s?d.circularOfId:null,d.children=[],[d,d]}return[R({id:f,index:o,key:t,getValue:()=>r,depth:i,collapsed:!0,type:I(r),path:h,parentId:l?l.id:null,circularOfId:null,children:[]}),d]}function I(o){return Array.isArray(o)?"array":o instanceof Map?"map":o instanceof Set?"set":o instanceof Date?"date":o===null?"null":typeof o}function Z(o,t){switch(t){case"array":return o.map((i,l)=>[l.toString(),i]);case"map":return Array.from(o.entries()).map(([i,l],a)=>[`[map entry ${a}]`,{"[key]":i,"[value]":l}]);case"set":return Array.from(o.values()).map((i,l)=>[`[set entry ${l}]`,i]);case"object":return Object.entries(o);default:return[]}}function $(o,t,r,i){if(t){if(o.collapsed&&t?.collapsed)return!1;if(i.stopCircularRecursion){if(i.isCircularNode)return!i.isCircularNode(o,r);if(o.type==="object"||o.type==="array"){const l=r.get(o.getValue());if(l&&o.id!==l.id)return o.circularOfId=l.id,!1;r.set(o.getValue(),o)}}else return!0}else return!0;return!0}function T(o,t,r,i,l,a,h,f,d,g,s){if(s.omitKeys?.includes(t)||s.maxDepth&&i>s.maxDepth)return null;const[p,w]=F(o,t,r,i,a,h);if(l?p.collapsed=!1:w&&!g?p.collapsed=w.collapsed:s.shouldExpandNode&&(p.collapsed=!s.shouldExpandNode(p)),h[p.id]=p,f.delete(p.id),$(p,a,d,s)){const u=(s.mapChildren&&s.mapChildren(r,I(r),p))??Z(r,I(r)),e=[];for(let n=0;n<u.length;n+=1){const[c,y]=u[n],x=T(n,c,y,i+1,!1,p,h,f,d,g,s);x&&e.push(x.id)}p.children=e}return p}const ee=o=>{const[t]=F(-1,"root",[],0,null,{}),r=R({[t.id]:t}),i=C(()=>r[t.id]),l=S(null),a=S(o),h=L(a,e=>e.recursionOpts),f=new Map;function d(e){a.set(e)}function g(e){l.set(e)}function s(e,n){const{valueFormatter:c}=O(a),y=c?c(e,n):void 0;if(y)return y;switch(n.type){case"array":return`${n.circularOfId?"circular":""} [] ${e.length} items`;case"object":return`${n.circularOfId?"circular":""} {} ${Object.keys(e).length} keys`;case"map":case"set":return`${n.circularOfId?"circular":""} () ${e.size} entries`;case"date":return`${e.toISOString()}`;case"string":return`"${e}"`;case"number":return e;case"boolean":return e?"true":"false";case"symbol":return String(e);default:return n.type}}function p(e,n,c){const y=new Set(Object.keys(r));f.clear(),T(t.index,t.key,e,t.depth,!0,null,r,y,f,c,n);for(const x of y)delete r[x];O(a).onUpdate?.(r)}function w(e){const n=r[e];if(!n)throw Error("Attempted to collapse non-existent node: "+JSON.stringify(n));n.collapsed=!n.collapsed;const c=O(h);c?N(n,c):O(a).onUpdate?.(r)}function N(e,n){const c=r[e.parentId||""];if(!c)throw Error("No parent in expandNodeChildren for node: "+JSON.stringify(e));T(e.index,e.key,e.getValue(),e.depth,!e.collapsed,c,r,new Set,f,!1,n),O(a).onUpdate?.(r)}function u(e){function n(c){c&&(r[c.id].collapsed=!1,c.parentId&&n(r[c.parentId]))}n(r[e]),O(a).onUpdate?.(r)}return{recursionOpts:h,rootElement:l,rootNode:m(i),treeMap:r,viewProps:a,setProps:d,setRootElement:g,formatValue:s,createTree:p,toggleCollapse:w,expandNodeChildren:N,expandAllNodesToNode:u}};var te=M("<ul><!></ul>");function le(o,t){U(t,!0);const r=u=>{var e=_(),n=b(e);Q(n,17,()=>m(g),X,(c,y)=>{j(c,{get id(){return m(y)}})}),v(u,e)},i={maxDepth:16,omitKeys:[],stopCircularRecursion:!1,shouldExpandNode:()=>!1};let l=H(t,["$$slots","$$events","$$legacy","data","rootNode","treeNode","theme","showLogButton","showCopyButton","recursionOpts","valueFormatter","onUpdate"]),a={treeNode:t.treeNode,theme:t.theme,showLogButton:t.showLogButton,showCopyButton:t.showCopyButton,recursionOpts:{...i,...t.recursionOpts},valueFormatter:t.valueFormatter,onUpdate:t.onUpdate},h;const f=ee(a),d=C(()=>({...i,...t.recursionOpts})),g=C(()=>f.rootNode.children);D("svelte-tree-view",f),A(()=>{f.setRootElement(h)}),E(()=>{a={treeNode:t.treeNode,showLogButton:t.showLogButton,showCopyButton:t.showCopyButton,recursionOpts:a.recursionOpts,valueFormatter:t.valueFormatter,onUpdate:t.onUpdate},f.setProps(a)}),E(()=>{const u=O(f.recursionOpts),e={...m(d)},n=t.data,c=u?.shouldExpandNode!==e.shouldExpandNode;J(()=>{f.createTree(n,e,c),f.setProps(a),a.recursionOpts=e})}),E(()=>{for(const u in t.theme){const e=t.theme[u];h&&u.includes("base")&&e&&h.style.setProperty(`--tree-view-${u}`,e)}});var s=_(),p=b(s);{var w=u=>{var e=_(),n=b(e);k(n,()=>t.rootNode,()=>r),v(u,e)},N=u=>{var e=te();W(e,()=>({...l,class:`${t.class||""} svelte-tree-view`}),void 0,void 0,"svelte-auvmwf");var n=K(e);r(n),q(e),G(e,c=>h=c,()=>h),v(u,e)};z(p,u=>{t.rootNode?u(w):u(N,!1)})}v(o,s),B()}export{le as T};
