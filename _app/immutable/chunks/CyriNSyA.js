import"./NZTpNUN0.js";import{o as pe}from"./Ba2SDbxX.js";import{S as he,B as A,D as U,O as T,E as V,a as m,T as S,Q as B,G as j,P as H,R as J,H as w,C as D,U as E,r as Q,aj as M,F as Y,at as ve,au as R,g as x,y as ge,u as F,k as me}from"./C5ZeV78G.js";import{i as I,c as _e,s as ye,b as be,r as we}from"./D4jLHckW.js";import{e as P,d as X,f as Z,i as $,k as Ne}from"./DwW8aOf1.js";import{s as L,a as ee}from"./4YIckaYW.js";var Oe=U("<button>â–¶</button>"),Ce=U('<button class="log-copy-button svelte-ngcjq5">log</button>'),xe=U('<button class="log-copy-button svelte-ngcjq5">copy</button>'),je=U('<li class="row svelte-ngcjq5"><ul class="svelte-ngcjq5"></ul></li>'),Te=U('<li><!> <div role="presentation"> </div> <div role="presentation"> </div> <div class="buttons svelte-ngcjq5"><!> <!></div></li> <!>',1);function Se(r,e){A(e,!0);const[d,t]=ee(),s=()=>L(o,"$propsObj",d),{propsStore:{props:o,formatValue:c}}=e.getTreeContext();let a=S(()=>e.node.children.length>0),l=S(()=>!e.node.collapsed&&m(a)),f=S(()=>c(e.node.getValue(),e.node));var n=Te(),h=T(n);let u;var N=V(h);{var C=v=>{var _=Oe();_.__click=function(...O){e.handleToggleCollapse?.apply(this,O)},H(()=>P(_,1,`arrow-btn ${e.node.collapsed?"collapsed":""}`,"svelte-ngcjq5")),w(v,_)};I(N,v=>{m(a)&&v(C)})}var y=B(N,2);let p;y.__click=function(...v){e.handleToggleCollapse?.apply(this,v)};var i=V(y);j(y);var g=B(y,2);let b;g.__click=function(...v){e.handleToggleCollapse?.apply(this,v)};var k=V(g,!0);j(g);var W=B(g,2),z=V(W);{var oe=v=>{var _=Ce();_.__click=function(...O){e.handleLogNode?.apply(this,O)},w(v,_)};I(z,v=>{s().showLogButton&&v(oe)})}var ne=B(z,2);{var se=v=>{var _=xe();_.__click=function(...O){e.handleCopyNodeToClipboard?.apply(this,O)},w(v,_)};I(ne,v=>{s().showCopyButton&&v(se)})}j(W),j(h);var ae=B(h,2);{var le=v=>{var _=je(),O=V(_);Z(O,21,()=>e.node.children,$,(ie,ce)=>{var G=E(),de=T(G);_e(de,()=>e.TreeViewNode,(ue,fe)=>{fe(ue,{get id(){return m(ce)}})}),w(ie,G)}),j(O),j(_),w(v,_)};I(ae,v=>{m(l)&&v(le)})}H((v,_,O)=>{u=P(h,1,"row svelte-ngcjq5",null,u,v),X(h,"data-tree-id",e.node.id),p=P(y,1,"node-key svelte-ngcjq5",null,p,_),J(i,`${e.node.key??""}:`),b=P(g,1,"node-value svelte-ngcjq5",null,b,O),X(g,"data-type",e.node.type),J(k,m(f))},[()=>({collapsed:e.node.collapsed&&m(a)}),()=>({"has-children":m(a),"p-left":!m(a)}),()=>({expanded:!e.node.collapsed&&m(a),"has-children":m(a)})]),w(r,n),D(),t()}he(["click"]);function te(r,e){A(e,!0);const[d,t]=ee(),s=()=>L(l,"$rootElementStore",d),o=()=>L(f,"$propsObj",d),{treeStore:c,propsStore:a,rootElementStore:l}=Q("svelte-tree-view");let{props:f}=a,n=M(c.treeMap[e.id]),h=S(()=>n&&n.children.length>0),u=S(()=>({node:n,getTreeContext:()=>Q("svelte-tree-view"),TreeViewNode:te,handleLogNode(){console.info("%c [svelte-tree-view]: Property added to window._node","color: #b8e248"),console.log(n.getValue());try{typeof window<"u"&&(window._node=n.getValue())}catch{console.error("Failed to set _node, window was undefined")}},handleCopyNodeToClipboard(){try{navigator.clipboard.writeText(JSON.stringify(n.getValue()))}catch(i){console.error("Copying node to clipboard failed: ",i)}},handleToggleCollapse(){m(h)?c.toggleCollapse(n.id):n.circularOfId&&(c.expandAllNodesToNode(n.circularOfId),s()?.querySelector(`li[data-tree-id="${n.circularOfId}"]`)?.scrollIntoView())}}));var N=E(),C=T(N);{var y=i=>{var g=E(),b=T(g);Y(b,()=>o().treeNode,()=>m(u)),w(i,g)},p=i=>{Se(i,ye(()=>m(u)))};I(C,i=>{o().treeNode?i(y):i(p,!1)})}w(r,N),D(),t()}const ke=r=>{const e=R(r),d=ve(e,t=>t.recursionOpts);return{props:e,recursionOpts:d,setProps(t){e.set(t)},formatValue(t,s){const{valueFormatter:o}=x(e),c=o?o(t,s):void 0;if(c)return c;switch(s.type){case"array":return`${s.circularOfId?"circular":""} [] ${t.length} items`;case"object":return`${s.circularOfId?"circular":""} {} ${Object.keys(t).length} keys`;case"map":case"set":return`${s.circularOfId?"circular":""} () ${t.size} entries`;case"date":return`${t.toISOString()}`;case"string":return`"${t}"`;case"number":return t;case"boolean":return t?"true":"false";case"symbol":return String(t);default:return s.type}}}},Ve=()=>{const r=R(null);return{set:r.set,subscribe:r.subscribe}};function re(r,e,d,t,s,o){const c=s?[...s.path,r]:[],a=`[${c.join(",")}]`,l=o[a];return l?(l.key=e,l.getValue=()=>d,l.depth=t,l.type=q(d),l.circularOfId=null,l.children=[],[l,l]):[M({id:a,index:r,key:e,getValue:()=>d,depth:t,collapsed:!0,type:q(d),path:c,parentId:s?s.id:null,circularOfId:null,children:[]}),l]}function q(r){return Array.isArray(r)?"array":r instanceof Map?"map":r instanceof Set?"set":r instanceof Date?"date":r===null?"null":typeof r}function Ie(r,e){switch(e){case"array":return r.map((t,s)=>[s.toString(),t]);case"map":return Array.from(r.entries()).map(([t,s],o)=>[`[map entry ${o}]`,{"[key]":t,"[value]":s}]);case"set":return Array.from(r.values()).map((t,s)=>[`[set entry ${s}]`,t]);case"object":return Object.entries(r);default:return[]}}function Ee(r,e,d,t){if(e){if(r.collapsed&&e?.collapsed)return!1;if(t.stopCircularRecursion){if(t.isCircularNode)return t.isCircularNode(r,d);if(r.type==="object"||r.type==="array"){const s=d.get(r.getValue());if(s&&r.id!==s.id)return r.circularOfId=s.id,!1;d.set(r.getValue(),r)}}else return!0}else return!0;return!0}function K(r,e,d,t,s,o,c,a,l,f,n){var h;if(!((h=n.omitKeys)===null||h===void 0)&&h.includes(e)||n.maxDepth&&t>n.maxDepth)return null;const[u,N]=re(r,e,d,t,o,c);if(s?u.collapsed=!1:N&&!f?u.collapsed=N.collapsed:n.shouldExpandNode&&(u.collapsed=!n.shouldExpandNode(u)),c[u.id]=u,a.delete(u.id),Ee(u,o,l,n)){const C=n.mapChildren&&n.mapChildren(d,q(d),u),y=C??Ie(d,q(d)),p=[];for(let i=0;i<y.length;i+=1){const[g,b]=y[i],k=K(i,g,b,t+1,!1,u,c,a,l,f,n);k?p.push(k.id):console.error("recurseObjectProperties produced unexpected null TreeNode for parent",u)}u.children=p}return u}function Ue(r,e,d,t){const s=new Set(Object.keys(e)),o=new Map,c=K(-1,"root",r,0,!0,null,e,s,o,t,d);for(const a of s)delete e[a];return{tree:c,iteratedValues:o}}const Be=r=>{const[e]=re(0,"root",[],0,null,{}),d=R(e),t=M({}),s=R(new Map);return{tree:d,treeMap:t,defaultRootNode:e,update(o,c,a){var l,f;const n=Ue(o,t,c,a);n.tree?d.set(n.tree):d.set(e),s.set(n.iteratedValues),(f=(l=x(r.props)).onUpdate)===null||f===void 0||f.call(l,t)},toggleCollapse(o){var c,a;const l=t[o];if(!l){console.warn(`Attempted to collapse non-existent node: ${o}`);return}l.collapsed=!l.collapsed;const f=x(r.recursionOpts);f?this.expandNodeChildren(l,f):(a=(c=x(r.props)).onUpdate)===null||a===void 0||a.call(c,t)},expandNodeChildren(o,c){var a,l;const n=t[o?.parentId||""]||null;if(!n)throw Error("No parent in expandNodeChildren for node: "+o);const h=x(s),u=K(o.index,o.key,o.getValue(),o.depth,!o.collapsed,n,t,new Set,h,!1,c);u&&(t[u.id]=u,t[n.id]=n,s.set(h),(l=(a=x(r.props)).onUpdate)===null||l===void 0||l.call(a,t))},expandAllNodesToNode(o){var c,a;function l(n,h){h&&(n[h.id].collapsed=!1,h.parentId&&l(n,n[h.parentId]))}const f=t;l(f,f[o]),(a=(c=x(r.props)).onUpdate)===null||a===void 0||a.call(c,f)}}};var Pe=U("<ul><!></ul>");function Me(r,e){A(e,!0);const d=p=>{var i=E(),g=T(i);Z(g,17,()=>m(h),$,(b,k)=>{te(b,{get id(){return m(k)}})}),w(p,i)},t={maxDepth:16,omitKeys:[],stopCircularRecursion:!1,shouldExpandNode:()=>!1};let s=we(e,["$$slots","$$events","$$legacy","data","rootNode","treeNode","theme","showLogButton","showCopyButton","recursionOpts","valueFormatter","onUpdate"]),o={treeNode:e.treeNode,theme:e.theme,showLogButton:e.showLogButton,showCopyButton:e.showCopyButton,recursionOpts:{...t,...e.recursionOpts},valueFormatter:e.valueFormatter,onUpdate:e.onUpdate},c;const a=ke(o),l=Ve(),f=Be(a),n=S(()=>({...t,...e.recursionOpts})),h=S(()=>f.treeMap["[]"]?.children);ge("svelte-tree-view",{propsStore:a,rootElementStore:l,treeStore:f}),pe(()=>{l.set(c)}),F(()=>{o={treeNode:e.treeNode,showLogButton:e.showLogButton,showCopyButton:e.showCopyButton,recursionOpts:o.recursionOpts,valueFormatter:e.valueFormatter,onUpdate:e.onUpdate},a.setProps(o)}),F(()=>{const p=x(a.recursionOpts),i={...m(n)},g=e.data,b=p?.shouldExpandNode!==i.shouldExpandNode;me(()=>{f.update(g,i,b),a.setProps(o),o.recursionOpts=i})}),F(()=>{for(const p in e.theme){const i=e.theme[p];c&&p.includes("base")&&i&&c.style.setProperty(`--tree-view-${p}`,i)}});var u=E(),N=T(u);{var C=p=>{var i=E(),g=T(i);Y(g,()=>e.rootNode,()=>d),w(p,i)},y=p=>{var i=Pe();Ne(i,()=>({...s,class:`${e.class||""} svelte-tree-view`}),void 0,"svelte-auvmwf");var g=V(i);d(g),j(i),be(i,b=>c=b,()=>c),w(p,i)};I(N,p=>{e.rootNode?p(C):p(y,!1)})}w(r,u),D()}export{Me as T};
