import"./NZTpNUN0.js";import{o as $}from"./Ba2SDbxX.js";import{S as ue,B as W,D as R,O as k,E,a as f,T as P,Q as q,G as I,P as Q,R as X,H as w,C as z,U as F,r as Y,ao as fe,aj as pe,g as C,b as he,F as ee,at as ve,au as M,y as me,u as U,k as ge}from"./C5ZeV78G.js";import{i as B,c as _e,s as ye,b as be,r as we}from"./D4jLHckW.js";import{f as L,e as Z,g as te,i as re,l as Ne}from"./D6Cqd9ze.js";import{s as A,a as G}from"./4YIckaYW.js";var Ce=R("<button>â–¶</button>"),Oe=R('<button class="log-copy-button svelte-ngcjq5">log</button>'),xe=R('<button class="log-copy-button svelte-ngcjq5">copy</button>'),je=R('<li class="row svelte-ngcjq5"><ul class="svelte-ngcjq5"></ul></li>'),Te=R('<li><!> <div role="presentation"> </div> <div role="presentation"> </div> <div class="buttons svelte-ngcjq5"><!> <!></div></li> <!>',1);function Se(o,e){W(e,!0);const[i,t]=G(),s=()=>A(r,"$propsObj",i),{propsStore:{props:r}}=e.getTreeContext();let n=P(()=>e.node&&e.node.children.length>0),d=P(()=>!e.node.collapsed&&f(n));var c=Te(),l=k(c);let a;var g=E(l);{var u=h=>{var _=Ce();_.__click=function(...x){e.handleToggleCollapse?.apply(this,x)},Q(()=>L(_,1,`arrow-btn ${e.node.collapsed?"collapsed":""}`,"svelte-ngcjq5")),w(h,_)};B(g,h=>{f(n)&&h(u)})}var b=q(g,2);let O;b.__click=function(...h){e.handleToggleCollapse?.apply(this,h)};var T=E(b);I(b);var y=q(b,2);let m;y.__click=function(...h){e.handleToggleCollapse?.apply(this,h)};var N=E(y,!0);I(y);var v=q(y,2),p=E(v);{var j=h=>{var _=Oe();_.__click=function(...x){e.handleLogNode?.apply(this,x)},w(h,_)};B(p,h=>{s().showLogButton&&h(j)})}var S=q(p,2);{var D=h=>{var _=xe();_.__click=function(...x){e.handleCopyNodeToClipboard?.apply(this,x)},w(h,_)};B(S,h=>{s().showCopyButton&&h(D)})}I(v),I(l);var ne=q(l,2);{var ae=h=>{var _=je(),x=E(_);te(x,21,()=>e.node.children,re,(V,le)=>{var J=F(),ie=k(J);_e(ie,()=>e.TreeViewNode,(ce,de)=>{de(ce,{get id(){return f(le).id}})}),w(V,J)}),I(x),I(_),w(h,_)};B(ne,h=>{f(d)&&h(ae)})}Q((h,_,x,V)=>{a=L(l,1,"row svelte-ngcjq5",null,a,h),Z(l,"data-tree-id",e.node.id),O=L(b,1,"node-key svelte-ngcjq5",null,O,_),X(T,`${e.node.key??""}:`),m=L(y,1,"node-value svelte-ngcjq5",null,m,x),Z(y,"data-type",e.node.type),X(N,V)},[()=>({collapsed:e.node.collapsed&&f(n)}),()=>({"has-children":f(n),"p-left":!f(n)}),()=>({expanded:!e.node.collapsed&&f(n),"has-children":f(n)}),()=>s().valueFormatter?.(e.node.value,e.node)]),w(o,c),z(),t()}ue(["click"]);function oe(o,e){W(e,!0);const[i,t]=G(),s=()=>A(c,"$rootElementStore",i),r=()=>A(l,"$propsObj",i),{treeStore:n,propsStore:d,rootElementStore:c}=Y("svelte-tree-view");let{props:l}=d,a=fe(pe(C(n.treeMap)[e.id])),g=P(()=>f(a)&&f(a).children.length>0),u=P(()=>({node:f(a),getTreeContext:()=>Y("svelte-tree-view"),TreeViewNode:oe,handleLogNode(){console.info("%c [svelte-tree-view]: Property added to window._node","color: #b8e248"),console.log(f(a).value);try{typeof window<"u"&&(window._node=f(a).value)}catch{console.error("Failed to set _node, window was undefined")}},handleCopyNodeToClipboard(){try{navigator.clipboard.writeText(JSON.stringify(f(a).value))}catch(m){console.error("Copying node to clipboard failed: ",m)}},handleToggleCollapse(){f(g)?n.toggleCollapse(f(a).id):f(a).circularOfId&&(n.expandAllNodesToNode(f(a).circularOfId),s()?.querySelector(`li[data-tree-id="${f(a).circularOfId}"]`)?.scrollIntoView())}}));$(()=>{n.treeMap.subscribe(m=>{const N=m[e.id];N&&he(a,N,!0)})});var b=F(),O=k(b);{var T=m=>{var N=F(),v=k(N);ee(v,()=>r().treeNode,()=>f(u)),w(m,N)},y=m=>{Se(m,ye(()=>f(u)))};B(O,m=>{r().treeNode?m(T):m(y,!1)})}w(o,b),z(),t()}const Ie=o=>{const e=M(o),i=ve(e,t=>t.recursionOpts);return{props:e,recursionOpts:i,setProps(t){e.set(t)},formatValue(t,s){const{valueFormatter:r}=C(e),n=r?r(t,s):void 0;if(n)return n;switch(s.type){case"array":return`${s.circularOfId?"circular":""} [] ${t.length} items`;case"object":return`${s.circularOfId?"circular":""} {} ${Object.keys(t).length} keys`;case"map":case"set":return`${s.circularOfId?"circular":""} () ${t.size} entries`;case"date":return`${t.toISOString()}`;case"string":return`"${t}"`;case"boolean":return t?"true":"false";case"symbol":return String(t);default:return s.type}}}},ke=()=>{const o=M(null);return{set:o.set,subscribe:o.subscribe}};function se(o,e,i,t,s){const r=s?[...s.path,o]:[];return{id:`[${r.join(",")}]`,index:o,key:e,value:i,depth:t,collapsed:!0,type:K(i),path:r,parentId:s?s.id:null,circularOfId:null,children:[]}}function K(o){return Array.isArray(o)?"array":o instanceof Map?"map":o instanceof Set?"set":o instanceof Date?"date":o===null?"null":typeof o}function Ee(o,e){switch(e){case"array":return o.map((t,s)=>[s.toString(),t]);case"map":return Array.from(o.entries()).map(([t,s],r)=>[`[map entry ${r}]`,{"[key]":t,"[value]":s}]);case"set":return Array.from(o.values()).map((t,s)=>[`[set entry ${s}]`,t]);case"object":return Object.entries(o);default:return[]}}function Be(o,e,i,t){if(e){if(o.collapsed&&e?.collapsed)return!1;if(t.stopCircularRecursion){if(t.isCircularNode)return t.isCircularNode(o,i);if(o.type==="object"||o.type==="array"){const s=i.get(o.value);if(s&&o.id!==s.id)return o.circularOfId=s.id,!1;i.set(o.value,o)}}else return!0}else return!0;return!0}function H(o,e,i,t,s,r,n,d,c,l,a){var g;if(!((g=a.omitKeys)===null||g===void 0)&&g.includes(e)||a.maxDepth&&t>a.maxDepth)return null;const u=se(o,e,i,t,r),b=d[u.id];if(s?u.collapsed=!1:b&&!l?u.collapsed=b.collapsed:a.shouldExpandNode&&(u.collapsed=!a.shouldExpandNode(u)),n[u.id]=u,Be(u,r,c,a)){const O=a.mapChildren&&a.mapChildren(i,K(i),u),T=O??Ee(i,K(i));u.children=T.map(([y,m],N)=>H(N,y,m,t+1,!1,u,n,d,c,l,a)).filter(y=>y!==null)}return u}function Fe(o,e,i,t){const s={},r=new Map,n=H(-1,"root",o,0,!0,null,s,e,r,t,i);return{treeMap:s,tree:n,iteratedValues:r}}const Re=o=>{const e=se(0,"root",[],0,null),i=M(e),t=M({}),s=M(new Map);return{tree:i,treeMap:t,defaultRootNode:e,init(r,n,d){r?i.set(r):i.set(e),t.set(n),s.set(d)},update(r,n,d){const c=C(t),l=Fe(r,c,n,d);l.tree?i.set(l.tree):i.set(e),t.set(l.treeMap),s.set(l.iteratedValues)},getNode(r){return C(t)[r]},toggleCollapse(r){const n=C(t)[r];if(!n){console.warn(`Attempted to collapse non-existent node: ${r}`);return}const d={...n,collapsed:!n.collapsed};t.update(l=>({...l,[n.id]:d}));const c=C(o.recursionOpts);c&&this.expandNodeChildren(d,c)},expandNodeChildren(r,n){const d=this.getNode(r?.parentId||"")||null;if(!d)throw Error("No parent in expandNodeChildren for node: "+r);const c={...C(t)},l=C(t),a=C(s),g=H(r.index,r.key,r.value,r.depth,!r.collapsed,d,c,l,a,!1,n);g&&(d.children=d.children.map(u=>u.id===g.id?g:u),c[g.id]=g,c[d.id]=d,t.set(c),s.set(a))},expandAllNodesToNode(r){function n(c,l){l&&(c[l.id]={...l,collapsed:!1},l.parentId&&n(c,c[l.parentId]))}const d={...C(t)};n(d,d[r]),t.set(d)}}};var qe=R("<ul><!></ul>");function Ue(o,e){W(e,!0);const[i,t]=G(),s=()=>A(O,"$tree",i),r=v=>{var p=F(),j=k(p);te(j,1,()=>s().children,re,(S,D)=>{oe(S,{get id(){return f(D).id}})}),w(v,p)},n={maxDepth:16,omitKeys:[],stopCircularRecursion:!1,shouldExpandNode:()=>!1};let d=we(e,["$$slots","$$events","$$legacy","data","rootNode","treeNode","theme","showLogButton","showCopyButton","recursionOpts","valueFormatter"]),c={treeNode:e.treeNode,theme:e.theme,showLogButton:e.showLogButton,showCopyButton:e.showCopyButton,recursionOpts:{...n,...e.recursionOpts},valueFormatter:e.valueFormatter},l;const a=Ie(c),g=ke(),u=Re(a),b=P(()=>({...n,...e.recursionOpts})),O=u.tree;me("svelte-tree-view",{propsStore:a,rootElementStore:g,treeStore:u}),$(()=>{g.set(l)}),U(()=>{c={treeNode:e.treeNode,showLogButton:e.showLogButton,showCopyButton:e.showCopyButton,recursionOpts:c.recursionOpts,valueFormatter:e.valueFormatter},a.setProps(c)}),U(()=>{const v=C(a.recursionOpts),p={...f(b)},j=e.data,S=v?.shouldExpandNode!==p.shouldExpandNode;ge(()=>{u.update(j,p,S),a.setProps(c),c.recursionOpts=p})}),U(()=>{for(const v in e.theme){const p=e.theme[v];l&&v.includes("base")&&p&&l.style.setProperty(`--tree-view-${v}`,p)}});var T=F(),y=k(T);{var m=v=>{var p=F(),j=k(p);ee(j,()=>e.rootNode,()=>r),w(v,p)},N=v=>{var p=qe();Ne(p,()=>({...d,class:`${e.class||""} svelte-tree-view`}),void 0,"svelte-auvmwf");var j=E(p);r(j),I(p),be(p,S=>l=S,()=>l),w(v,p)};B(y,v=>{e.rootNode?v(m):v(N,!1)})}w(o,T),z(),t()}export{Ue as T};
