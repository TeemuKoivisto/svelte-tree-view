import{c as I,a as w,f as k,d as _e,b as x,t as W,s as G}from"./lWD8Z06K.js";import{p as D,aV as H,G as b,t as g,J as S,a as j,a1 as $,v as X,ab as be,aU as Q,aW as Oe,q as _,aX as Ce,o as Ie,z as Y,A as Se,c as T,r as O,H as U,I as M}from"./BqIf-X89.js";import{i as C,b as Ve,r as Pe,c as Ee}from"./CcjuvQHP.js";import{c as B,l as Te,f as ee,i as te,e as R,d as Z}from"./Btf1R-hm.js";import{s as re,a as oe}from"./BhXXotsP.js";function se(t,e){D(e,!0);const r=()=>re(a,"$viewProps",o),[o,l]=oe(),{treeMap:u,viewProps:a}=H("svelte-tree-view");let n=S(()=>({node:u[e.id],TreeViewNode:se,getTreeContext:()=>H("svelte-tree-view")}));var f=I(),h=b(f);B(h,()=>r().treeNode,()=>g(n)),w(t,f),j(),l()}function q(t){return Array.isArray(t)?"array":t instanceof Map?"map":t instanceof Set?"set":t instanceof Date?"date":t===null?"null":typeof t}function ne(t,e,r,o,l,u,a,n){const f=l?[...l.path,t]:[];let h;a&&l?(h=a(r,e,l),n?.has(h)&&(console.error(`[svelte-tree-view]: Duplicate node id "${h}" for key "${e}". Falling back to generated id.`),h=crypto.randomUUID())):h=`[${f.join(",")}]`,n?.add(h);const s=u[h];if(s){const p=s.getValue()===r;return s.key=e,s.getValue=()=>r,s.depth=o,s.type=q(r),s.circularOfId=p?s.circularOfId:null,s.children=[],[s,s]}return[$({id:h,index:t,key:e,getValue:()=>r,depth:o,collapsed:!0,type:q(r),path:f,parentId:l?l.id:null,circularOfId:null,children:[]}),s]}function ke(t,e){switch(e){case"array":return t.map((o,l)=>[l.toString(),o]);case"map":return Array.from(t.entries()).map(([o,l],u)=>[`[map entry ${u}]`,{"[key]":o,"[value]":l}]);case"set":return Array.from(t.values()).map((o,l)=>[`[set entry ${l}]`,o]);case"object":return Object.entries(t);default:return[]}}function xe(t,e,r,o){if(e){if(t.collapsed&&e?.collapsed)return!1;if(o.stopCircularRecursion){if(o.isCircularNode)return!o.isCircularNode(t,r);if(t.type==="object"||t.type==="array"){const l=r.get(t.getValue());if(l&&t.id!==l.id)return t.circularOfId=l.id,!1;r.set(t.getValue(),t)}}else return!0}else return!0;return!0}function L(t,e,r,o,l,u,a){if(a.opts.omitKeys?.includes(e)||a.opts.maxDepth&&o>a.opts.maxDepth)return null;const[n,f]=ne(t,e,r,o,u,a.treeMap,a.opts.getNodeId,a.usedIds);if(l?n.collapsed=!1:f&&!a.recomputeExpandNode?n.collapsed=f.collapsed:a.opts.shouldExpandNode&&(n.collapsed=!a.opts.shouldExpandNode(n)),a.treeMap[n.id]=n,a.oldIds.delete(n.id),xe(n,u,a.iteratedValues,a.opts)){const s=(a.opts.mapChildren&&a.opts.mapChildren(r,q(r),n))??ke(r,q(r)),d=[];for(let p=0;p<s.length;p+=1){const[V,m]=s[p],v=L(p,V,m,o+1,!1,n,a);v&&d.push(v.id)}n.children=d}return n}function Me(t,e,r){const o=r?r(t,e):void 0;if(o)return o;switch(e.type){case"array":return`${e.circularOfId?"circular":""} [] ${t.length} items`;case"object":return`${e.circularOfId?"circular":""} {} ${Object.keys(t).length} keys`;case"map":case"set":return`${e.circularOfId?"circular":""} () ${t.size} entries`;case"date":return`${t.toISOString()}`;case"string":return`"${t}"`;case"number":case"boolean":case"symbol":return String(t);default:return e.type}}function Ue(t,e,r,o,l,u){o.clear();const a=new Set(Object.keys(r));L(e.index,e.key,t,e.depth,!0,null,{treeMap:r,oldIds:a,iteratedValues:o,recomputeExpandNode:u,opts:l,usedIds:new Set});for(const n of a)delete r[n]}function Re(t,e,r,o){const l=e[t.parentId||""];if(!l)throw Error("No parent in expandNodeChildren for node: "+JSON.stringify(t));L(t.index,t.key,t.getValue(),t.depth,!t.collapsed,l,{treeMap:e,oldIds:new Set,iteratedValues:r,recomputeExpandNode:!1,opts:o,usedIds:new Set})}function Be(t,e){function r(o){o&&(e[o.id].collapsed=!1,o.parentId&&r(e[o.parentId]))}r(e[t])}class qe{#e;get treeMap(){return g(this.#e)}set treeMap(e){X(this.#e,e,!0)}#t;get rootNode(){return g(this.#t)}set rootNode(e){X(this.#t,e)}constructor(e){this.defaultRootNode=ne(-1,"root",[],0,null,{})[0],this.#e=be($({[this.defaultRootNode.id]:this.defaultRootNode})),this.#t=S(()=>this.treeMap[this.defaultRootNode.id]),this.rootElement=Q(null),this.iteratedValues=new Map,this.viewProps=Q(e),this.recursionOpts=Oe(this.viewProps,r=>r.recursionOpts)}}const Ae=t=>{const e=new qe(t);function r(s){e.viewProps.set(s)}function o(s){e.rootElement.set(s)}function l(s,d){const{valueFormatter:p}=_(e.viewProps);return Me(s,d,p)}function u(s,d,p){Ue(s,e.defaultRootNode,e.treeMap,e.iteratedValues,d,p),_(e.viewProps).onUpdate?.(e.treeMap)}function a(s){const d=e.treeMap[s];if(!d)throw Error("Attempted to collapse non-existent node: "+JSON.stringify(d));d.collapsed=!d.collapsed;const p=_(e.recursionOpts);p?n(d,p):_(e.viewProps).onUpdate?.(e.treeMap)}function n(s,d){Re(s,e.treeMap,e.iteratedValues,d),_(e.viewProps).onUpdate?.(e.treeMap)}function f(s){Be(s,e.treeMap),_(e.viewProps).onUpdate?.(e.treeMap)}function h(s){const d=e.treeMap[s];d.children.length>0?a(s):d.circularOfId&&(f(d.circularOfId),_(e.rootElement)?.querySelector(`[data-tree-node-id="${d.circularOfId}"]`)?.scrollIntoView())}return{get recursionOpts(){return e.recursionOpts},get rootElement(){return e.rootElement},get rootNode(){return e.rootNode},get treeMap(){return e.treeMap},get viewProps(){return e.viewProps},setProps:r,setRootElement:o,formatValue:l,createTree:u,toggleCollapse:a,expandNodeChildren:n,expandAllNodesToNode:f,collapseOrScrollIntoCircularNode:h}};var De=k("<ul><!></ul>");function Ze(t,e){D(e,!0);const r=m=>{var v=I(),y=b(v);ee(y,17,()=>g(h),te,(N,A)=>{se(N,{get id(){return g(A)}})}),w(m,v)},o={maxDepth:16,omitKeys:[],stopCircularRecursion:!1,shouldExpandNode:()=>!1};let l=Pe(e,["$$slots","$$events","$$legacy","data","rootNode","treeNode","showLogButton","showCopyButton","recursionOpts","valueFormatter","onUpdate"]),u={treeNode:e.treeNode,showLogButton:e.showLogButton,showCopyButton:e.showCopyButton,recursionOpts:{...o,...e.recursionOpts},valueFormatter:e.valueFormatter,onUpdate:e.onUpdate},a;const n=Ae(u),f=S(()=>({...o,...e.recursionOpts})),h=S(()=>n.rootNode.children);Ce("svelte-tree-view",n),Ie(()=>{n.setRootElement(a)}),Y(()=>{u={treeNode:e.treeNode,showLogButton:e.showLogButton,showCopyButton:e.showCopyButton,recursionOpts:u.recursionOpts,valueFormatter:e.valueFormatter,onUpdate:e.onUpdate},n.setProps(u)}),Y(()=>{const m=_(n.recursionOpts),v={...g(f)},y=e.data,N=m?.shouldExpandNode!==v.shouldExpandNode;Se(()=>{n.createTree(y,v,N),n.setProps(u),u.recursionOpts=v})});var s=I(),d=b(s);{var p=m=>{var v=I(),y=b(v);B(y,()=>e.rootNode,()=>r),w(m,v)},V=m=>{var v=De();Te(v,()=>({...l,class:`svelte-tree-view ${e.class||""}`}),void 0,void 0,void 0,"svelte-kh8cnf");var y=T(v);r(y),O(v),Ve(v,N=>a=N,()=>a),w(m,v)};C(d,m=>{e.rootNode?m(p):m(V,!1)})}w(t,s),j()}function je(t){console.log(t.getValue());try{window._node=t.getValue(),console.info("%c [svelte-tree-view]: Property added to window._node","color: #b8e248")}catch(e){console.error("[svelte-tree-view]: handleLogNode() errored",e)}}function Le(t){try{navigator.clipboard.writeText(JSON.stringify(t.getValue()))}catch(e){console.error("[svelte-tree-view]: handleCopyNodeToClipboard() errored",e)}}var Fe=k("<button>â–¶</button>"),Je=k('<button class="log-copy-button svelte-5sy4qp">log</button>'),ze=k('<button class="log-copy-button svelte-5sy4qp">copy</button>'),Ke=k('<li class="row svelte-5sy4qp"><ul class="svelte-5sy4qp"></ul></li>'),We=k('<li><!> <div role="presentation"><!></div> <div role="presentation"><!></div> <div class="buttons svelte-5sy4qp"><!> <!></div></li> <!>',1);function $e(t,e){D(e,!0);const r=()=>re(u,"$viewProps",o),[o,l]=oe(),{viewProps:u,formatValue:a,collapseOrScrollIntoCircularNode:n}=e.getTreeContext();let f=S(()=>e.node.children.length>0),h=S(()=>!e.node.collapsed&&g(f)),s=S(()=>a(e.node.getValue(),e.node));var d=We(),p=b(d);let V;var m=T(p);{var v=i=>{var c=Fe();U(()=>R(c,1,`arrow-btn ${e.node.collapsed?"collapsed":""}`,"svelte-5sy4qp")),x("click",c,()=>n(e.node.id)),w(i,c)};C(m,i=>{g(f)&&i(v)})}var y=M(m,2);let N;var A=T(y);{var ae=i=>{var c=I(),E=b(c);B(E,()=>e.keySnippet,()=>e.node),w(i,c)},le=i=>{var c=W();U(()=>G(c,`${e.node.key??""}:`)),w(i,c)};C(A,i=>{e.keySnippet?i(ae):i(le,!1)})}O(y);var P=M(y,2);let F;var ie=T(P);{var de=i=>{var c=I(),E=b(c);B(E,()=>e.valueSnippet,()=>e.node),w(i,c)},ce=i=>{var c=W();U(()=>G(c,g(s))),w(i,c)};C(ie,i=>{e.valueSnippet?i(de):i(ce,!1)})}O(P);var J=M(P,2),z=T(J);{var ue=i=>{var c=Je();x("click",c,()=>je(e.node)),w(i,c)};C(z,i=>{r().showLogButton&&i(ue)})}var fe=M(z,2);{var pe=i=>{var c=ze();x("click",c,()=>Le(e.node)),w(i,c)};C(fe,i=>{r().showCopyButton&&i(pe)})}O(J),O(p);var ve=M(p,2);{var he=i=>{var c=Ke(),E=T(c);ee(E,21,()=>e.node.children,te,(ge,me)=>{var K=I(),we=b(K);Ee(we,()=>e.TreeViewNode,(ye,Ne)=>{Ne(ye,{get id(){return g(me)}})}),w(ge,K)}),O(E),O(c),w(i,c)};C(ve,i=>{g(h)&&i(he)})}U(()=>{V=R(p,1,"row svelte-5sy4qp",null,V,{collapsed:e.node.collapsed&&g(f)}),Z(p,"data-tree-node-id",e.node.id),N=R(y,1,"node-key svelte-5sy4qp",null,N,{"has-children":g(f),"p-left":!g(f)}),F=R(P,1,"node-value svelte-5sy4qp",null,F,{expanded:!e.node.collapsed&&g(f),"has-children":g(f)}),Z(P,"data-type",e.node.type)}),x("click",y,()=>n(e.node.id)),x("click",P,()=>n(e.node.id)),w(t,d),j(),l()}_e(["click"]);export{$e as D,Ze as T,Le as a,je as h};
