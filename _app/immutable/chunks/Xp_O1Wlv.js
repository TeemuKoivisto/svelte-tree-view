import{c as x,a as v,f as F}from"./-ovcc_Db.js";import{p as U,aa as V,G as _,t as m,J as C,a as k,a1 as B,ab as L,ac as S,q as O,ad as D,o as J,z as E,A as M,c as q,r as z}from"./uS0-QRX5.js";import{i as K,b as G,r as W}from"./Cj3drD5l.js";import{d as R,h as H,g as Q,i as X}from"./CMffLH_N.js";import{s as P,a as Y}from"./BF6bDuwG.js";function j(o,t){U(t,!0);const r=()=>P(h,"$rootElement",a),c=()=>P(d,"$viewProps",a),[a,i]=Y(),{rootElement:h,treeMap:f,viewProps:d,...g}=V("svelte-tree-view");let s=C(()=>f[t.id]),p=C(()=>m(s).children.length>0),w=C(()=>({node:m(s),getTreeContext:()=>V("svelte-tree-view"),TreeViewNode:j,handleLogNode(){console.log(m(s).getValue());try{window._node=m(s).getValue(),console.info("%c [svelte-tree-view]: Property added to window._node","color: #b8e248")}catch(e){console.error("[svelte-tree-view]: handleLogNode() errored",e)}},handleCopyNodeToClipboard(){try{navigator.clipboard.writeText(JSON.stringify(m(s).getValue()))}catch(e){console.error("[svelte-tree-view]: handleCopyNodeToClipboard() errored",e)}},handleToggleCollapse(){m(p)?g.toggleCollapse(m(s).id):m(s).circularOfId&&(g.expandAllNodesToNode(m(s).circularOfId),r()?.querySelector(`[data-tree-node-id="${m(s).circularOfId}"]`)?.scrollIntoView())}}));var N=x(),u=_(N);R(u,()=>c().treeNode,()=>m(w)),v(o,N),k(),i()}function A(o,t,r,c,a,i){const h=a?[...a.path,o]:[],f=`[${h.join(",")}]`,d=i[f];if(d){const s=d.getValue()===r;return d.key=t,d.getValue=()=>r,d.depth=c,d.type=I(r),d.circularOfId=s?d.circularOfId:null,d.children=[],[d,d]}return[B({id:f,index:o,key:t,getValue:()=>r,depth:c,collapsed:!0,type:I(r),path:h,parentId:a?a.id:null,circularOfId:null,children:[]}),d]}function I(o){return Array.isArray(o)?"array":o instanceof Map?"map":o instanceof Set?"set":o instanceof Date?"date":o===null?"null":typeof o}function Z(o,t){switch(t){case"array":return o.map((c,a)=>[a.toString(),c]);case"map":return Array.from(o.entries()).map(([c,a],i)=>[`[map entry ${i}]`,{"[key]":c,"[value]":a}]);case"set":return Array.from(o.values()).map((c,a)=>[`[set entry ${a}]`,c]);case"object":return Object.entries(o);default:return[]}}function $(o,t,r,c){if(t){if(o.collapsed&&t?.collapsed)return!1;if(c.stopCircularRecursion){if(c.isCircularNode)return!c.isCircularNode(o,r);if(o.type==="object"||o.type==="array"){const a=r.get(o.getValue());if(a&&o.id!==a.id)return o.circularOfId=a.id,!1;r.set(o.getValue(),o)}}else return!0}else return!0;return!0}function T(o,t,r,c,a,i,h,f,d,g,s){if(s.omitKeys?.includes(t)||s.maxDepth&&c>s.maxDepth)return null;const[p,w]=A(o,t,r,c,i,h);if(a?p.collapsed=!1:w&&!g?p.collapsed=w.collapsed:s.shouldExpandNode&&(p.collapsed=!s.shouldExpandNode(p)),h[p.id]=p,f.delete(p.id),$(p,i,d,s)){const u=(s.mapChildren&&s.mapChildren(r,I(r),p))??Z(r,I(r)),e=[];for(let n=0;n<u.length;n+=1){const[l,y]=u[n],b=T(n,l,y,c+1,!1,p,h,f,d,g,s);b&&e.push(b.id)}p.children=e}return p}const ee=o=>{const[t]=A(-1,"root",[],0,null,{}),r=B({[t.id]:t}),c=C(()=>r[t.id]),a=S(null),i=S(o),h=L(i,e=>e.recursionOpts),f=new Map;function d(e){i.set(e)}function g(e){a.set(e)}function s(e,n){const{valueFormatter:l}=O(i),y=l?l(e,n):void 0;if(y)return y;switch(n.type){case"array":return`${n.circularOfId?"circular":""} [] ${e.length} items`;case"object":return`${n.circularOfId?"circular":""} {} ${Object.keys(e).length} keys`;case"map":case"set":return`${n.circularOfId?"circular":""} () ${e.size} entries`;case"date":return`${e.toISOString()}`;case"string":return`"${e}"`;case"number":return e;case"boolean":return e?"true":"false";case"symbol":return String(e);default:return n.type}}function p(e,n,l){const y=new Set(Object.keys(r));f.clear(),T(t.index,t.key,e,t.depth,!0,null,r,y,f,l,n);for(const b of y)delete r[b];O(i).onUpdate?.(r)}function w(e){const n=r[e];if(!n)throw Error("Attempted to collapse non-existent node: "+JSON.stringify(n));n.collapsed=!n.collapsed;const l=O(h);l?N(n,l):O(i).onUpdate?.(r)}function N(e,n){const l=r[e.parentId||""];if(!l)throw Error("No parent in expandNodeChildren for node: "+JSON.stringify(e));T(e.index,e.key,e.getValue(),e.depth,!e.collapsed,l,r,new Set,f,!1,n),O(i).onUpdate?.(r)}function u(e){function n(l){l&&(r[l.id].collapsed=!1,l.parentId&&n(r[l.parentId]))}n(r[e]),O(i).onUpdate?.(r)}return{recursionOpts:h,rootElement:a,rootNode:m(c),treeMap:r,viewProps:i,setProps:d,setRootElement:g,formatValue:s,createTree:p,toggleCollapse:w,expandNodeChildren:N,expandAllNodesToNode:u}};var te=F("<ul><!></ul>");function ie(o,t){U(t,!0);const r=u=>{var e=x(),n=_(e);Q(n,17,()=>m(g),X,(l,y)=>{j(l,{get id(){return m(y)}})}),v(u,e)},c={maxDepth:16,omitKeys:[],stopCircularRecursion:!1,shouldExpandNode:()=>!1};let a=W(t,["$$slots","$$events","$$legacy","data","rootNode","treeNode","theme","showLogButton","showCopyButton","recursionOpts","valueFormatter","onUpdate"]),i={treeNode:t.treeNode,theme:t.theme,showLogButton:t.showLogButton,showCopyButton:t.showCopyButton,recursionOpts:{...c,...t.recursionOpts},valueFormatter:t.valueFormatter,onUpdate:t.onUpdate},h;const f=ee(i),d=C(()=>({...c,...t.recursionOpts})),g=C(()=>f.rootNode.children);D("svelte-tree-view",f),J(()=>{f.setRootElement(h)}),E(()=>{i={treeNode:t.treeNode,showLogButton:t.showLogButton,showCopyButton:t.showCopyButton,recursionOpts:i.recursionOpts,valueFormatter:t.valueFormatter,onUpdate:t.onUpdate},f.setProps(i)}),E(()=>{const u=O(f.recursionOpts),e={...m(d)},n=t.data,l=u?.shouldExpandNode!==e.shouldExpandNode;M(()=>{f.createTree(n,e,l),f.setProps(i),i.recursionOpts=e})}),E(()=>{for(const u in t.theme){const e=t.theme[u];h&&u.includes("base")&&e&&h.style.setProperty(`--tree-view-${u}`,e)}});var s=x(),p=_(s);{var w=u=>{var e=x(),n=_(e);R(n,()=>t.rootNode,()=>r),v(u,e)},N=u=>{var e=te();H(e,()=>({...a,class:`${t.class||""} svelte-tree-view`}),void 0,void 0,void 0,"svelte-kh8cnf");var n=q(e);r(n),z(e),G(e,l=>h=l,()=>h),v(u,e)};K(p,u=>{t.rootNode?u(w):u(N,!1)})}v(o,s),k()}export{ie as T};
