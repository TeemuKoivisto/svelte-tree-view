import{c as b,a as O,f as D}from"./-ovcc_Db.js";import{p as k,aa as V,G as x,t as v,J as _,a as B,a1 as R,ab as L,ac as U,q as N,ad as J,o as M,z as S,A as q,c as z,r as K}from"./uS0-QRX5.js";import{i as G,b as W,r as H}from"./Cj3drD5l.js";import{d as j,h as Q,g as X,i as Y}from"./CuTqTKGc.js";import{s as P,a as Z}from"./BF6bDuwG.js";function A(o,e){k(e,!0);const r=()=>P(h,"$rootElement",i),d=()=>P(p,"$viewProps",i),[i,l]=Z(),{rootElement:h,treeMap:a,viewProps:p,...f}=V("svelte-tree-view");let n=_(()=>({node:a[e.id],getTreeContext:()=>V("svelte-tree-view"),TreeViewNode:A,handleLogNode(){console.log(a[e.id].getValue());try{window._node=a[e.id].getValue(),console.info("%c [svelte-tree-view]: Property added to window._node","color: #b8e248")}catch(g){console.error("[svelte-tree-view]: handleLogNode() errored",g)}},handleCopyNodeToClipboard(){try{navigator.clipboard.writeText(JSON.stringify(a[e.id].getValue()))}catch(g){console.error("[svelte-tree-view]: handleCopyNodeToClipboard() errored",g)}},handleToggleCollapse(){a[e.id].children.length>0?f.toggleCollapse(a[e.id].id):a[e.id].circularOfId&&(f.expandAllNodesToNode(a[e.id].circularOfId),r()?.querySelector(`[data-tree-node-id="${a[e.id].circularOfId}"]`)?.scrollIntoView())}}));var y=b(),u=x(y);j(u,()=>d().treeNode,()=>v(n)),O(o,y),B(),l()}function F(o,e,r,d,i,l,h,a){const p=i?[...i.path,o]:[];let f;h&&i?(f=h(r,e,i),a?.has(f)&&(console.error(`[svelte-tree-view]: Duplicate node id "${f}" for key "${e}". Falling back to generated id.`),f=crypto.randomUUID())):f=`[${p.join(",")}]`,a?.add(f);const n=l[f];if(n){const u=n.getValue()===r;return n.key=e,n.getValue=()=>r,n.depth=d,n.type=I(r),n.circularOfId=u?n.circularOfId:null,n.children=[],[n,n]}return[R({id:f,index:o,key:e,getValue:()=>r,depth:d,collapsed:!0,type:I(r),path:p,parentId:i?i.id:null,circularOfId:null,children:[]}),n]}function I(o){return Array.isArray(o)?"array":o instanceof Map?"map":o instanceof Set?"set":o instanceof Date?"date":o===null?"null":typeof o}function $(o,e){switch(e){case"array":return o.map((d,i)=>[i.toString(),d]);case"map":return Array.from(o.entries()).map(([d,i],l)=>[`[map entry ${l}]`,{"[key]":d,"[value]":i}]);case"set":return Array.from(o.values()).map((d,i)=>[`[set entry ${i}]`,d]);case"object":return Object.entries(o);default:return[]}}function ee(o,e,r,d){if(e){if(o.collapsed&&e?.collapsed)return!1;if(d.stopCircularRecursion){if(d.isCircularNode)return!d.isCircularNode(o,r);if(o.type==="object"||o.type==="array"){const i=r.get(o.getValue());if(i&&o.id!==i.id)return o.circularOfId=i.id,!1;r.set(o.getValue(),o)}}else return!0}else return!0;return!0}function T(o,e,r,d,i,l,h,a,p,f,n,y){if(n.omitKeys?.includes(e)||n.maxDepth&&d>n.maxDepth)return null;const[u,g]=F(o,e,r,d,l,h,n.getNodeId,y);if(i?u.collapsed=!1:g&&!f?u.collapsed=g.collapsed:n.shouldExpandNode&&(u.collapsed=!n.shouldExpandNode(u)),h[u.id]=u,a.delete(u.id),ee(u,l,p,n)){const t=(n.mapChildren&&n.mapChildren(r,I(r),u))??$(r,I(r)),s=[];for(let c=0;c<t.length;c+=1){const[w,E]=t[c],C=T(c,w,E,d+1,!1,u,h,a,p,f,n,y);C&&s.push(C.id)}u.children=s}return u}const te=o=>{const[e]=F(-1,"root",[],0,null,{}),r=R({[e.id]:e}),d=_(()=>r[e.id]),i=U(null),l=U(o),h=L(l,t=>t.recursionOpts),a=new Map;function p(t){l.set(t)}function f(t){i.set(t)}function n(t,s){const{valueFormatter:c}=N(l),w=c?c(t,s):void 0;if(w)return w;switch(s.type){case"array":return`${s.circularOfId?"circular":""} [] ${t.length} items`;case"object":return`${s.circularOfId?"circular":""} {} ${Object.keys(t).length} keys`;case"map":case"set":return`${s.circularOfId?"circular":""} () ${t.size} entries`;case"date":return`${t.toISOString()}`;case"string":return`"${t}"`;case"number":case"boolean":case"symbol":return String(t);default:return s.type}}function y(t,s,c){const w=new Set(Object.keys(r)),E=new Set;a.clear(),T(e.index,e.key,t,e.depth,!0,null,r,w,a,c,s,E);for(const C of w)delete r[C];N(l).onUpdate?.(r)}function u(t){const s=r[t];if(!s)throw Error("Attempted to collapse non-existent node: "+JSON.stringify(s));s.collapsed=!s.collapsed;const c=N(h);c?g(s,c):N(l).onUpdate?.(r)}function g(t,s){const c=r[t.parentId||""];if(!c)throw Error("No parent in expandNodeChildren for node: "+JSON.stringify(t));T(t.index,t.key,t.getValue(),t.depth,!t.collapsed,c,r,new Set,a,!1,s,new Set),N(l).onUpdate?.(r)}function m(t){function s(c){c&&(r[c.id].collapsed=!1,c.parentId&&s(r[c.parentId]))}s(r[t]),N(l).onUpdate?.(r)}return{recursionOpts:h,rootElement:i,rootNode:v(d),treeMap:r,viewProps:l,setProps:p,setRootElement:f,formatValue:n,createTree:y,toggleCollapse:u,expandNodeChildren:g,expandAllNodesToNode:m}};var re=D("<ul><!></ul>");function ce(o,e){k(e,!0);const r=m=>{var t=b(),s=x(t);X(s,17,()=>v(f),Y,(c,w)=>{A(c,{get id(){return v(w)}})}),O(m,t)},d={maxDepth:16,omitKeys:[],stopCircularRecursion:!1,shouldExpandNode:()=>!1};let i=H(e,["$$slots","$$events","$$legacy","data","rootNode","treeNode","theme","showLogButton","showCopyButton","recursionOpts","valueFormatter","onUpdate"]),l={treeNode:e.treeNode,theme:e.theme,showLogButton:e.showLogButton,showCopyButton:e.showCopyButton,recursionOpts:{...d,...e.recursionOpts},valueFormatter:e.valueFormatter,onUpdate:e.onUpdate},h;const a=te(l),p=_(()=>({...d,...e.recursionOpts})),f=_(()=>a.rootNode.children);J("svelte-tree-view",a),M(()=>{a.setRootElement(h)}),S(()=>{l={treeNode:e.treeNode,showLogButton:e.showLogButton,showCopyButton:e.showCopyButton,recursionOpts:l.recursionOpts,valueFormatter:e.valueFormatter,onUpdate:e.onUpdate},a.setProps(l)}),S(()=>{const m=N(a.recursionOpts),t={...v(p)},s=e.data,c=m?.shouldExpandNode!==t.shouldExpandNode;q(()=>{a.createTree(s,t,c),a.setProps(l),l.recursionOpts=t})}),S(()=>{for(const m in e.theme){const t=e.theme[m];h&&m.includes("base")&&t&&h.style.setProperty(`--tree-view-${m}`,t)}});var n=b(),y=x(n);{var u=m=>{var t=b(),s=x(t);j(s,()=>e.rootNode,()=>r),O(m,t)},g=m=>{var t=re();Q(t,()=>({...i,class:`svelte-tree-view ${e.class||""}`}),void 0,void 0,void 0,"svelte-kh8cnf");var s=z(t);r(s),K(t),W(t,c=>h=c,()=>h),O(m,t)};G(y,m=>{e.rootNode?m(u):m(g,!1)})}O(o,n),B()}export{ce as T};
