import"./NZTpNUN0.js";import{S as _e,B as M,D as U,O as S,Q as B,E as I,P as R,a as m,H as _,C as K,T as j,G as T,U as E,F,V as Q,R as X,r as Y,aj as W,at as ye,au as $,g as V,y as be,u as D,k as we}from"./C5ZeV78G.js";import{i as k,c as Ne,b as Ce,r as Oe}from"./D4jLHckW.js";import{e as q,d as Z,f as ee,i as te,k as xe}from"./DIjv_465.js";import{a as oe,s as L}from"./4YIckaYW.js";import{o as Se}from"./Ba2SDbxX.js";var je=U("<button>â–¶</button>"),Te=U('<button class="log-copy-button svelte-ngcjq5">log</button>'),ke=U('<button class="log-copy-button svelte-ngcjq5">copy</button>'),Ve=U('<li class="row svelte-ngcjq5"><ul class="svelte-ngcjq5"></ul></li>'),Ee=U('<li><!> <div role="presentation"><!></div> <div role="presentation"><!></div> <div class="buttons svelte-ngcjq5"><!> <!></div></li> <!>',1);function We(t,e){M(e,!0);const[o,r]=oe(),s=()=>L(n,"$propsObj",o),{propsStore:{props:n,formatValue:d}}=e.getTreeContext();let i=j(()=>e.node.children.length>0),c=j(()=>!e.node.collapsed&&m(i)),h=j(()=>d(e.node.getValue(),e.node));var a=Ee(),v=S(a);let p;var C=I(v);{var O=l=>{var u=je();u.__click=function(...y){e.handleToggleCollapse?.apply(this,y)},R(()=>q(u,1,`arrow-btn ${e.node.collapsed?"collapsed":""}`,"svelte-ngcjq5")),_(l,u)};k(C,l=>{m(i)&&l(O)})}var b=B(C,2);let g;b.__click=function(...l){e.handleToggleCollapse?.apply(this,l)};var f=I(b);{var w=l=>{var u=E(),y=S(u);F(y,()=>e.keySnippet,()=>e.node),_(l,u)},x=l=>{var u=Q();R(()=>X(u,`${e.node.key??""}:`)),_(l,u)};k(f,l=>{e.keySnippet?l(w):l(x,!1)})}T(b);var N=B(b,2);let z;N.__click=function(...l){e.handleToggleCollapse?.apply(this,l)};var ae=I(N);{var le=l=>{var u=E(),y=S(u);F(y,()=>e.valueSnippet,()=>e.node),_(l,u)},se=l=>{var u=Q();R(()=>X(u,m(h))),_(l,u)};k(ae,l=>{e.valueSnippet?l(le):l(se,!1)})}T(N);var G=B(N,2),H=I(G);{var ie=l=>{var u=Te();u.__click=function(...y){e.handleLogNode?.apply(this,y)},_(l,u)};k(H,l=>{s().showLogButton&&l(ie)})}var ce=B(H,2);{var de=l=>{var u=ke();u.__click=function(...y){e.handleCopyNodeToClipboard?.apply(this,y)},_(l,u)};k(ce,l=>{s().showCopyButton&&l(de)})}T(G),T(v);var ue=B(v,2);{var fe=l=>{var u=Ve(),y=I(u);ee(y,21,()=>e.node.children,te,(ve,he)=>{var J=E(),pe=S(J);Ne(pe,()=>e.TreeViewNode,(ge,me)=>{me(ge,{get id(){return m(he)}})}),_(ve,J)}),T(y),T(u),_(l,u)};k(ue,l=>{m(c)&&l(fe)})}R((l,u,y)=>{p=q(v,1,"row svelte-ngcjq5",null,p,l),Z(v,"data-tree-id",e.node.id),g=q(b,1,"node-key svelte-ngcjq5",null,g,u),z=q(N,1,"node-value svelte-ngcjq5",null,z,y),Z(N,"data-type",e.node.type)},[()=>({collapsed:e.node.collapsed&&m(i)}),()=>({"has-children":m(i),"p-left":!m(i)}),()=>({expanded:!e.node.collapsed&&m(i),"has-children":m(i)})]),_(t,a),K(),r()}_e(["click"]);function re(t,e){M(e,!0);const[o,r]=oe(),s=()=>L(c,"$rootElementStore",o),n=()=>L(h,"$propsObj",o),{treeStore:d,propsStore:i,rootElementStore:c}=Y("svelte-tree-view");let{props:h}=i,a=W(d.treeMap[e.id]),v=j(()=>a&&a.children.length>0),p=j(()=>({node:a,getTreeContext:()=>Y("svelte-tree-view"),TreeViewNode:re,handleLogNode(){console.info("%c [svelte-tree-view]: Property added to window._node","color: #b8e248"),console.log(a.getValue());try{typeof window<"u"&&(window._node=a.getValue())}catch{console.error("Failed to set _node, window was undefined")}},handleCopyNodeToClipboard(){try{navigator.clipboard.writeText(JSON.stringify(a.getValue()))}catch(b){console.error("Copying node to clipboard failed: ",b)}},handleToggleCollapse(){m(v)?d.toggleCollapse(a.id):a.circularOfId&&(d.expandAllNodesToNode(a.circularOfId),s()?.querySelector(`li[data-tree-id="${a.circularOfId}"]`)?.scrollIntoView())}}));var C=E(),O=S(C);F(O,()=>n().treeNode,()=>m(p)),_(t,C),K(),r()}const Ie=t=>{const e=$(t),o=ye(e,r=>r.recursionOpts);return{props:e,recursionOpts:o,setProps(r){e.set(r)},formatValue(r,s){const{valueFormatter:n}=V(e),d=n?n(r,s):void 0;if(d)return d;switch(s.type){case"array":return`${s.circularOfId?"circular":""} [] ${r.length} items`;case"object":return`${s.circularOfId?"circular":""} {} ${Object.keys(r).length} keys`;case"map":case"set":return`${s.circularOfId?"circular":""} () ${r.size} entries`;case"date":return`${r.toISOString()}`;case"string":return`"${r}"`;case"number":return r;case"boolean":return r?"true":"false";case"symbol":return String(r);default:return s.type}}}},Ue=()=>{const t=$(null);return{set:t.set,subscribe:t.subscribe}};function ne(t,e,o,r,s,n){const d=s?[...s.path,t]:[],i=`[${d.join(",")}]`,c=n[i];return c?(c.key=e,c.getValue=()=>o,c.depth=r,c.type=P(o),c.children=[],[c,c]):[W({id:i,index:t,key:e,getValue:()=>o,depth:r,collapsed:!0,type:P(o),path:d,parentId:s?s.id:null,circularOfId:null,children:[]}),c]}function P(t){return Array.isArray(t)?"array":t instanceof Map?"map":t instanceof Set?"set":t instanceof Date?"date":t===null?"null":typeof t}function Be(t,e){switch(e){case"array":return t.map((r,s)=>[s.toString(),r]);case"map":return Array.from(t.entries()).map(([r,s],n)=>[`[map entry ${n}]`,{"[key]":r,"[value]":s}]);case"set":return Array.from(t.values()).map((r,s)=>[`[set entry ${s}]`,r]);case"object":return Object.entries(t);default:return[]}}function Re(t,e,o,r){if(e){if(t.collapsed&&e?.collapsed)return!1;if(r.stopCircularRecursion){if(r.isCircularNode)return r.isCircularNode(t,o);if(t.type==="object"||t.type==="array"){const s=o.get(t.getValue());if(s&&t.id!==s.id)return t.circularOfId=s.id,!1;o.set(t.getValue(),t)}}else return!0}else return!0;return!0}function A(t,e,o,r,s,n,d,i,c,h,a){var v;if(!((v=a.omitKeys)===null||v===void 0)&&v.includes(e)||a.maxDepth&&r>a.maxDepth)return null;const[p,C]=ne(t,e,o,r,n,d);if(s?p.collapsed=!1:C&&!h?p.collapsed=C.collapsed:a.shouldExpandNode&&(p.collapsed=!a.shouldExpandNode(p)),d[p.id]=p,i.delete(p.id),Re(p,n,c,a)){const O=a.mapChildren&&a.mapChildren(o,P(o),p),b=O??Be(o,P(o)),g=[];for(let f=0;f<b.length;f+=1){const[w,x]=b[f],N=A(f,w,x,r+1,!1,p,d,i,c,h,a);N&&g.push(N.id)}p.children=g}return p}const qe=t=>{const[e]=ne(-1,"root",[],0,null,{}),o=W({[e.id]:e}),r=j(()=>o[e.id]),s=new Map;return{treeMap:o,rootNode:m(r),recompute(n,d,i){var c,h;const a=new Set(Object.keys(o));s.clear(),A(e.index,e.key,n,e.depth,!0,null,o,a,s,i,d);for(const v of a)delete o[v];(h=(c=V(t.props)).onUpdate)===null||h===void 0||h.call(c,o)},toggleCollapse(n){var d,i;const c=o[n];if(!c)return console.warn(`Attempted to collapse non-existent node: ${n}`);c.collapsed=!c.collapsed;const h=V(t.recursionOpts);h?this.expandNodeChildren(c,h):(i=(d=V(t.props)).onUpdate)===null||i===void 0||i.call(d,o)},expandNodeChildren(n,d){var i,c;const a=o[n?.parentId||""]||null;if(!a)throw Error("No parent in expandNodeChildren for node: "+n);const v=A(n.index,n.key,n.getValue(),n.depth,!n.collapsed,a,o,new Set,s,!1,d);v&&(o[v.id]=v,o[a.id]=a,(c=(i=V(t.props)).onUpdate)===null||c===void 0||c.call(i,o))},expandAllNodesToNode(n){var d,i;function c(a,v){v&&(a[v.id].collapsed=!1,v.parentId&&c(a,a[v.parentId]))}const h=o;c(h,h[n]),(i=(d=V(t.props)).onUpdate)===null||i===void 0||i.call(d,h)}}};var Fe=U("<ul><!></ul>");function ze(t,e){M(e,!0);const o=g=>{var f=E(),w=S(f);ee(w,17,()=>m(v),te,(x,N)=>{re(x,{get id(){return m(N)}})}),_(g,f)},r={maxDepth:16,omitKeys:[],stopCircularRecursion:!1,shouldExpandNode:()=>!1};let s=Oe(e,["$$slots","$$events","$$legacy","data","rootNode","treeNode","theme","showLogButton","showCopyButton","recursionOpts","valueFormatter","onUpdate"]),n={treeNode:e.treeNode,theme:e.theme,showLogButton:e.showLogButton,showCopyButton:e.showCopyButton,recursionOpts:{...r,...e.recursionOpts},valueFormatter:e.valueFormatter,onUpdate:e.onUpdate},d;const i=Ie(n),c=Ue(),h=qe(i),a=j(()=>({...r,...e.recursionOpts})),v=j(()=>h.rootNode.children);be("svelte-tree-view",{propsStore:i,rootElementStore:c,treeStore:h}),Se(()=>{c.set(d)}),D(()=>{n={treeNode:e.treeNode,showLogButton:e.showLogButton,showCopyButton:e.showCopyButton,recursionOpts:n.recursionOpts,valueFormatter:e.valueFormatter,onUpdate:e.onUpdate},i.setProps(n)}),D(()=>{const g=V(i.recursionOpts),f={...m(a)},w=e.data,x=g?.shouldExpandNode!==f.shouldExpandNode;we(()=>{h.recompute(w,f,x),i.setProps(n),n.recursionOpts=f})}),D(()=>{for(const g in e.theme){const f=e.theme[g];d&&g.includes("base")&&f&&d.style.setProperty(`--tree-view-${g}`,f)}});var p=E(),C=S(p);{var O=g=>{var f=E(),w=S(f);F(w,()=>e.rootNode,()=>o),_(g,f)},b=g=>{var f=Fe();xe(f,()=>({...s,class:`${e.class||""} svelte-tree-view`}),void 0,"svelte-auvmwf");var w=I(f);o(w),T(f),Ce(f,x=>d=x,()=>d),_(g,f)};k(C,g=>{e.rootNode?g(O):g(b,!1)})}_(t,p),K()}export{We as D,ze as T};
