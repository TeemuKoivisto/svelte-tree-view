import{c as C,a as w,f as E,d as Oe,b as T,e as W,t as Q,s as X}from"./DdtxOMYw.js";import{p as F,ah as Y,E as I,l as h,J as S,a as L,a1 as ee,q as j,ab as te,ai as Z,aj as Ce,k as _,ak as Ie,o as Se,x as $,y as Pe,G as x,H as b,F as B,I as M}from"./DgRHvA05.js";import{i as O,b as Ve,r as xe,c as Ee}from"./BUXqfv4L.js";import{f as D,l as ke,e as re,i as oe,d as q,c as R}from"./qcKXYCGW.js";import{s as se,a as ne}from"./BkfkNcBg.js";function ae(t,e){F(e,!0);const r=()=>se(a,"$viewProps",o),[o,l]=ne(),{treeMap:p,viewProps:a}=Y("svelte-tree-view");let n=S(()=>({node:p[e.id],TreeViewNode:ae,getTreeContext:()=>Y("svelte-tree-view")}));var f=C(),g=I(f);D(g,()=>r().treeNode,()=>h(n)),w(t,f),L(),l()}function A(t){return Array.isArray(t)?"array":t instanceof Map?"map":t instanceof Set?"set":t instanceof Date?"date":t===null?"null":typeof t}function le(t,e,r,o,l,p,a,n){const f=l?[...l.path,t]:[];let g;a&&l?(g=a(r,e,l),n?.has(g)&&(console.error(`[svelte-tree-view]: Duplicate node id "${g}" for key "${e}". Falling back to generated id.`),g=crypto.randomUUID())):g=`[${f.join(",")}]`,n?.add(g);const s=p[g];if(s){const u=s.getValue()===r;return s.key=e,s.getValue=()=>r,s.depth=o,s.type=A(r),s.circularOfId=u?s.circularOfId:null,s.children=[],[s,s]}return[ee({id:g,index:t,key:e,getValue:()=>r,depth:o,collapsed:!0,type:A(r),path:f,parentId:l?l.id:null,circularOfId:null,children:[]}),s]}function Te(t,e){switch(e){case"array":return t.map((o,l)=>[l.toString(),o]);case"map":return Array.from(t.entries()).map(([o,l],p)=>[`[map entry ${p}]`,{"[key]":o,"[value]":l}]);case"set":return Array.from(t.values()).map((o,l)=>[`[set entry ${l}]`,o]);case"object":return Object.entries(t);default:return[]}}function Me(t,e,r,o){if(e){if(t.collapsed&&e?.collapsed)return!1;if(o.stopCircularRecursion){if(o.isCircularNode)return!o.isCircularNode(t,r);if(t.type==="object"||t.type==="array"){const l=r.get(t.getValue());if(l&&t.id!==l.id)return t.circularOfId=l.id,!1;r.set(t.getValue(),t)}}else return!0}else return!0;return!0}function J(t,e,r,o,l,p,a){if(a.opts.omitKeys?.includes(e)||a.opts.maxDepth&&o>a.opts.maxDepth)return null;const[n,f]=le(t,e,r,o,p,a.treeMap,a.opts.getNodeId,a.usedIds);if(l?n.collapsed=!1:f&&!a.recomputeExpandNode?n.collapsed=f.collapsed:a.opts.shouldExpandNode&&(n.collapsed=!a.opts.shouldExpandNode(n)),a.treeMap[n.id]=n,a.oldIds.delete(n.id),Me(n,p,a.iteratedValues,a.opts)){const s=(a.opts.mapChildren&&a.opts.mapChildren(r,A(r),n))??Te(r,A(r)),c=[];for(let u=0;u<s.length;u+=1){const[P,m]=s[u],v=J(u,P,m,o+1,!1,n,a);v&&c.push(v.id)}n.children=c}return n}function Re(t,e,r){const o=r?r(t,e):void 0;if(o)return o;switch(e.type){case"array":return`${e.circularOfId?"circular":""} [] ${t.length} items`;case"object":return`${e.circularOfId?"circular":""} {} ${Object.keys(t).length} keys`;case"map":case"set":return`${e.circularOfId?"circular":""} () ${t.size} entries`;case"date":return`${t.toISOString()}`;case"string":return`"${t}"`;case"number":case"boolean":case"symbol":return String(t);default:return e.type}}function Ue(t,e,r,o,l,p){o.clear();const a=new Set(Object.keys(r));J(e.index,e.key,t,e.depth,!0,null,{treeMap:r,oldIds:a,iteratedValues:o,recomputeExpandNode:p,opts:l,usedIds:new Set});for(const n of a)delete r[n]}function Be(t,e,r,o){const l=e[t.parentId||""];if(!l)throw Error("No parent in expandNodeChildren for node: "+JSON.stringify(t));J(t.index,t.key,t.getValue(),t.depth,!t.collapsed,l,{treeMap:e,oldIds:new Set,iteratedValues:r,recomputeExpandNode:!1,opts:o,usedIds:new Set})}function qe(t,e){function r(o){o&&(e[o.id].collapsed=!1,o.parentId&&r(e[o.parentId]))}r(e[t])}class je{#e;get treeMap(){return h(this.#e)}set treeMap(e){j(this.#e,e,!0)}#t;get rootNode(){return h(this.#t)}set rootNode(e){j(this.#t,e)}constructor(e){this.defaultRootNode=le(-1,"root",[],0,null,{})[0],this.#e=te(ee({[this.defaultRootNode.id]:this.defaultRootNode})),this.#t=S(()=>this.treeMap[this.defaultRootNode.id]),this.rootElement=Z(null),this.iteratedValues=new Map,this.viewProps=Z(e),this.recursionOpts=Ce(this.viewProps,r=>r.recursionOpts)}}const De=t=>{const e=new je(t);function r(s){e.viewProps.set(s)}function o(s){e.rootElement.set(s)}function l(s,c){const{valueFormatter:u}=_(e.viewProps);return Re(s,c,u)}function p(s,c,u){Ue(s,e.defaultRootNode,e.treeMap,e.iteratedValues,c,u),_(e.viewProps).onUpdate?.(e.treeMap)}function a(s){const c=e.treeMap[s];if(!c)throw Error("Attempted to collapse non-existent node: "+JSON.stringify(c));c.collapsed=!c.collapsed;const u=_(e.recursionOpts);u?n(c,u):_(e.viewProps).onUpdate?.(e.treeMap)}function n(s,c){Be(s,e.treeMap,e.iteratedValues,c),_(e.viewProps).onUpdate?.(e.treeMap)}function f(s){qe(s,e.treeMap),_(e.viewProps).onUpdate?.(e.treeMap)}function g(s){const c=e.treeMap[s];c.children.length>0?a(s):c.circularOfId&&(f(c.circularOfId),_(e.rootElement)?.querySelector(`[data-tree-node-id="${c.circularOfId}"]`)?.scrollIntoView())}return{get recursionOpts(){return e.recursionOpts},get rootElement(){return e.rootElement},get rootNode(){return e.rootNode},get treeMap(){return e.treeMap},get viewProps(){return e.viewProps},setProps:r,setRootElement:o,formatValue:l,createTree:p,toggleCollapse:a,expandNodeChildren:n,expandAllNodesToNode:f,collapseOrScrollIntoCircularNode:g}};var Ae=E("<ul><!></ul>");function $e(t,e){F(e,!0);const r=m=>{var v=C(),N=I(v);re(N,17,()=>h(g),oe,(y,U)=>{ae(y,{get id(){return h(U)}})}),w(m,v)},o={maxDepth:16,omitKeys:[],stopCircularRecursion:!1,shouldExpandNode:()=>!1};let l=xe(e,["$$slots","$$events","$$legacy","data","rootNode","treeNode","showLogButton","showCopyButton","recursionOpts","valueFormatter","onUpdate"]),p={treeNode:e.treeNode,showLogButton:e.showLogButton,showCopyButton:e.showCopyButton,recursionOpts:{...o,...e.recursionOpts},valueFormatter:e.valueFormatter,onUpdate:e.onUpdate},a;const n=De(p),f=S(()=>({...o,...e.recursionOpts})),g=S(()=>n.rootNode.children);Ie("svelte-tree-view",n),Se(()=>{n.setRootElement(a)}),$(()=>{p={treeNode:e.treeNode,showLogButton:e.showLogButton,showCopyButton:e.showCopyButton,recursionOpts:p.recursionOpts,valueFormatter:e.valueFormatter,onUpdate:e.onUpdate},n.setProps(p)}),$(()=>{const m=_(n.recursionOpts),v={...h(f)},N=e.data,y=m?.shouldExpandNode!==v.shouldExpandNode;Pe(()=>{n.createTree(N,v,y),n.setProps(p),p.recursionOpts=v})});var s=C(),c=I(s);{var u=m=>{var v=C(),N=I(v);D(N,()=>e.rootNode,()=>r),w(m,v)},P=m=>{var v=Ae();ke(v,()=>({...l,class:`svelte-tree-view ${e.class||""}`,role:"tree"}));var N=x(v);r(N),b(v),Ve(v,y=>a=y,()=>a),w(m,v)};O(c,m=>{e.rootNode?m(u):m(P,!1)})}w(t,s),L()}function Fe(t){console.log(t.getValue());try{window._node=t.getValue(),console.info("%c [svelte-tree-view]: Property added to window._node","color: #b8e248")}catch(e){console.error("[svelte-tree-view]: handleLogNode() errored",e)}}function Le(t){try{navigator.clipboard.writeText(JSON.stringify(t.getValue()))}catch(e){console.error("[svelte-tree-view]: handleCopyNodeToClipboard() errored",e)}}var Je=E("<button>â–¶</button>"),Ke=E('<button class="log-copy-button svelte-5sy4qp">log</button>'),ze=E('<button class="log-copy-button svelte-5sy4qp">copy</button>'),Ge=E('<ul class="row svelte-5sy4qp" role="group"></ul>'),He=E('<li role="treeitem"><div class="row-body svelte-5sy4qp"><!> <div role="presentation"><!></div> <div role="presentation"><!></div> <div class="buttons svelte-5sy4qp"><!> <!></div></div> <!></li>');function et(t,e){F(e,!0);const r=()=>se(p,"$viewProps",o),[o,l]=ne(),{viewProps:p,formatValue:a,collapseOrScrollIntoCircularNode:n}=e.getTreeContext();let f=S(()=>e.node.children.length>0),g=S(()=>!e.node.collapsed&&h(f)),s=S(()=>a(e.node.getValue(),e.node)),c=te(!1);var u=He();let P;var m=x(u),v=x(m);{var N=i=>{var d=Je();B(()=>q(d,1,`arrow-btn ${e.node.collapsed?"collapsed":""}`,"svelte-5sy4qp")),T("click",d,()=>n(e.node.id)),W("focus",d,()=>j(c,!0)),W("blur",d,()=>j(c,!1)),w(i,d)};O(v,i=>{h(f)&&i(N)})}var y=M(v,2);let U;var ie=x(y);{var de=i=>{var d=C(),k=I(d);D(k,()=>e.keySnippet,()=>e.node),w(i,d)},ce=i=>{var d=Q();B(()=>X(d,`${e.node.key??""}:`)),w(i,d)};O(ie,i=>{e.keySnippet?i(de):i(ce,!1)})}b(y);var V=M(y,2);let K;var ue=x(V);{var fe=i=>{var d=C(),k=I(d);D(k,()=>e.valueSnippet,()=>e.node),w(i,d)},pe=i=>{var d=Q();B(()=>X(d,h(s))),w(i,d)};O(ue,i=>{e.valueSnippet?i(fe):i(pe,!1)})}b(V);var z=M(V,2),G=x(z);{var ve=i=>{var d=Ke();T("click",d,()=>Fe(e.node)),w(i,d)};O(G,i=>{r().showLogButton&&i(ve)})}var he=M(G,2);{var ge=i=>{var d=ze();T("click",d,()=>Le(e.node)),w(i,d)};O(he,i=>{r().showCopyButton&&i(ge)})}b(z),b(m);var me=M(m,2);{var we=i=>{var d=Ge();re(d,21,()=>e.node.children,oe,(k,ye)=>{var H=C(),Ne=I(H);Ee(Ne,()=>e.TreeViewNode,(_e,be)=>{be(_e,{get id(){return h(ye)}})}),w(k,H)}),b(d),w(i,d)};O(me,i=>{h(g)&&i(we)})}b(u),B(()=>{P=q(u,1,"row svelte-5sy4qp",null,P,{collapsed:e.node.collapsed&&h(f)}),R(u,"data-tree-node-id",e.node.id),R(u,"aria-expanded",h(f)?e.node.collapsed?"false":"true":void 0),R(u,"aria-level",e.node.depth),R(u,"aria-selected",h(c)?"true":"false"),U=q(y,1,"node-key svelte-5sy4qp",null,U,{"has-children":h(f),"p-left":!h(f)}),K=q(V,1,"node-value svelte-5sy4qp",null,K,{expanded:!e.node.collapsed&&h(f),"has-children":h(f)}),R(V,"data-type",e.node.type)}),T("click",y,()=>n(e.node.id)),T("click",V,()=>n(e.node.id)),w(t,u),L(),l()}Oe(["click"]);export{et as D,$e as T,Le as a,Fe as h};
