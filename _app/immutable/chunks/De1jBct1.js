import{c as b,a as O,f as F}from"./-ovcc_Db.js";import{p as U,aa as V,G as x,t as C,J as _,a as k,a1 as B,ab as L,ac as S,q as N,ad as D,o as J,z as E,A as M,c as q,r as z}from"./uS0-QRX5.js";import{i as K,b as G,r as W}from"./Cj3drD5l.js";import{d as R,h as H,g as Q,i as X}from"./CuTqTKGc.js";import{s as P,a as Y}from"./BF6bDuwG.js";function j(o,e){U(e,!0);const r=()=>P(m,"$rootElement",a),c=()=>P(d,"$viewProps",a),[a,i]=Y(),{rootElement:m,treeMap:s,viewProps:d,...p}=V("svelte-tree-view");let h=_(()=>({node:s[e.id],getTreeContext:()=>V("svelte-tree-view"),TreeViewNode:j,handleLogNode(){console.log(s[e.id].getValue());try{window._node=s[e.id].getValue(),console.info("%c [svelte-tree-view]: Property added to window._node","color: #b8e248")}catch(g){console.error("[svelte-tree-view]: handleLogNode() errored",g)}},handleCopyNodeToClipboard(){try{navigator.clipboard.writeText(JSON.stringify(s[e.id].getValue()))}catch(g){console.error("[svelte-tree-view]: handleCopyNodeToClipboard() errored",g)}},handleToggleCollapse(){s[e.id].children.length>0?p.toggleCollapse(s[e.id].id):s[e.id].circularOfId&&(p.expandAllNodesToNode(s[e.id].circularOfId),r()?.querySelector(`[data-tree-node-id="${s[e.id].circularOfId}"]`)?.scrollIntoView())}}));var u=b(),w=x(u);R(w,()=>c().treeNode,()=>C(h)),O(o,u),k(),i()}function A(o,e,r,c,a,i){const m=a?[...a.path,o]:[],s=`[${m.join(",")}]`,d=i[s];if(d){const h=d.getValue()===r;return d.key=e,d.getValue=()=>r,d.depth=c,d.type=I(r),d.circularOfId=h?d.circularOfId:null,d.children=[],[d,d]}return[B({id:s,index:o,key:e,getValue:()=>r,depth:c,collapsed:!0,type:I(r),path:m,parentId:a?a.id:null,circularOfId:null,children:[]}),d]}function I(o){return Array.isArray(o)?"array":o instanceof Map?"map":o instanceof Set?"set":o instanceof Date?"date":o===null?"null":typeof o}function Z(o,e){switch(e){case"array":return o.map((c,a)=>[a.toString(),c]);case"map":return Array.from(o.entries()).map(([c,a],i)=>[`[map entry ${i}]`,{"[key]":c,"[value]":a}]);case"set":return Array.from(o.values()).map((c,a)=>[`[set entry ${a}]`,c]);case"object":return Object.entries(o);default:return[]}}function $(o,e,r,c){if(e){if(o.collapsed&&e?.collapsed)return!1;if(c.stopCircularRecursion){if(c.isCircularNode)return!c.isCircularNode(o,r);if(o.type==="object"||o.type==="array"){const a=r.get(o.getValue());if(a&&o.id!==a.id)return o.circularOfId=a.id,!1;r.set(o.getValue(),o)}}else return!0}else return!0;return!0}function T(o,e,r,c,a,i,m,s,d,p,h){if(h.omitKeys?.includes(e)||h.maxDepth&&c>h.maxDepth)return null;const[u,w]=A(o,e,r,c,i,m);if(a?u.collapsed=!1:w&&!p?u.collapsed=w.collapsed:h.shouldExpandNode&&(u.collapsed=!h.shouldExpandNode(u)),m[u.id]=u,s.delete(u.id),$(u,i,d,h)){const f=(h.mapChildren&&h.mapChildren(r,I(r),u))??Z(r,I(r)),t=[];for(let n=0;n<f.length;n+=1){const[l,y]=f[n],v=T(n,l,y,c+1,!1,u,m,s,d,p,h);v&&t.push(v.id)}u.children=t}return u}const ee=o=>{const[e]=A(-1,"root",[],0,null,{}),r=B({[e.id]:e}),c=_(()=>r[e.id]),a=S(null),i=S(o),m=L(i,t=>t.recursionOpts),s=new Map;function d(t){i.set(t)}function p(t){a.set(t)}function h(t,n){const{valueFormatter:l}=N(i),y=l?l(t,n):void 0;if(y)return y;switch(n.type){case"array":return`${n.circularOfId?"circular":""} [] ${t.length} items`;case"object":return`${n.circularOfId?"circular":""} {} ${Object.keys(t).length} keys`;case"map":case"set":return`${n.circularOfId?"circular":""} () ${t.size} entries`;case"date":return`${t.toISOString()}`;case"string":return`"${t}"`;case"number":case"boolean":case"symbol":return String(t);default:return n.type}}function u(t,n,l){const y=new Set(Object.keys(r));s.clear(),T(e.index,e.key,t,e.depth,!0,null,r,y,s,l,n);for(const v of y)delete r[v];N(i).onUpdate?.(r)}function w(t){const n=r[t];if(!n)throw Error("Attempted to collapse non-existent node: "+JSON.stringify(n));n.collapsed=!n.collapsed;const l=N(m);l?g(n,l):N(i).onUpdate?.(r)}function g(t,n){const l=r[t.parentId||""];if(!l)throw Error("No parent in expandNodeChildren for node: "+JSON.stringify(t));T(t.index,t.key,t.getValue(),t.depth,!t.collapsed,l,r,new Set,s,!1,n),N(i).onUpdate?.(r)}function f(t){function n(l){l&&(r[l.id].collapsed=!1,l.parentId&&n(r[l.parentId]))}n(r[t]),N(i).onUpdate?.(r)}return{recursionOpts:m,rootElement:a,rootNode:C(c),treeMap:r,viewProps:i,setProps:d,setRootElement:p,formatValue:h,createTree:u,toggleCollapse:w,expandNodeChildren:g,expandAllNodesToNode:f}};var te=F("<ul><!></ul>");function ie(o,e){U(e,!0);const r=f=>{var t=b(),n=x(t);Q(n,17,()=>C(p),X,(l,y)=>{j(l,{get id(){return C(y)}})}),O(f,t)},c={maxDepth:16,omitKeys:[],stopCircularRecursion:!1,shouldExpandNode:()=>!1};let a=W(e,["$$slots","$$events","$$legacy","data","rootNode","treeNode","theme","showLogButton","showCopyButton","recursionOpts","valueFormatter","onUpdate"]),i={treeNode:e.treeNode,theme:e.theme,showLogButton:e.showLogButton,showCopyButton:e.showCopyButton,recursionOpts:{...c,...e.recursionOpts},valueFormatter:e.valueFormatter,onUpdate:e.onUpdate},m;const s=ee(i),d=_(()=>({...c,...e.recursionOpts})),p=_(()=>s.rootNode.children);D("svelte-tree-view",s),J(()=>{s.setRootElement(m)}),E(()=>{i={treeNode:e.treeNode,showLogButton:e.showLogButton,showCopyButton:e.showCopyButton,recursionOpts:i.recursionOpts,valueFormatter:e.valueFormatter,onUpdate:e.onUpdate},s.setProps(i)}),E(()=>{const f=N(s.recursionOpts),t={...C(d)},n=e.data,l=f?.shouldExpandNode!==t.shouldExpandNode;M(()=>{s.createTree(n,t,l),s.setProps(i),i.recursionOpts=t})}),E(()=>{for(const f in e.theme){const t=e.theme[f];m&&f.includes("base")&&t&&m.style.setProperty(`--tree-view-${f}`,t)}});var h=b(),u=x(h);{var w=f=>{var t=b(),n=x(t);R(n,()=>e.rootNode,()=>r),O(f,t)},g=f=>{var t=te();H(t,()=>({...a,class:`${e.class||""} svelte-tree-view`}),void 0,void 0,void 0,"svelte-kh8cnf");var n=q(t);r(n),z(t),G(t,l=>m=l,()=>m),O(f,t)};K(u,f=>{e.rootNode?f(w):f(g,!1)})}O(o,h),k()}export{ie as T};
